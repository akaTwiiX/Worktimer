<div class="login">
    @if (isLoading) {
    <mat-spinner></mat-spinner>
    } @else {
    <form class="login-form">
        <div>
            <h2>Login</h2>
        </div>
        
        <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input matInput type="email" [formControl]="emailFormControl" placeholder="beispiel@email.de">
            @if (emailFormControl.hasError('email') && !emailFormControl.hasError('required')) {
            <mat-error>Bitte geben Sie eine gültige E-Mail-Adresse ein</mat-error>
            }
            @if (emailFormControl.hasError('required')) {
            <mat-error>E-Mail ist erforderlich</mat-error>
            }
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Passwort</mat-label>
            <input matInput type="password" [formControl]="passwordFormControl" placeholder="Passwort">
            @if (passwordFormControl.hasError('minlength')) {
            <mat-error>Passwort muss mindestens 8 Zeichen lang sein</mat-error>
            }
            @if (passwordFormControl.hasError('required')) {
            <mat-error>Passwort ist erforderlich</mat-error>
            }
        </mat-form-field>

        @if (errorMessage) {
        <div class="message error">{{errorMessage}}</div>
        }
        
        @if (emailNotVerified) {
        <div class="message warning">
            <p><strong>E-Mail nicht verifiziert!</strong></p>
            <p>Bitte überprüfen Sie Ihr E-Mail-Postfach und bestätigen Sie Ihre E-Mail-Adresse.</p>
            @if (verificationEmailSent) {
            <p class="success-text">✓ Verifikations-E-Mail wurde erneut gesendet!</p>
            } @else {
            <button mat-stroked-button color="accent" (click)="resendVerificationEmail()">
                Verifikations-E-Mail erneut senden
            </button>
            }
        </div>
        }

        <div class="btn-container">
            <button mat-raised-button color="primary" 
                    [disabled]="!emailFormControl.valid || !passwordFormControl.valid"
                    (click)="login()">
                Einloggen
            </button>
        </div>

        <div class="link-container">
            <a routerLink="/register">Noch kein Konto? Registrieren</a>
        </div>
    </form>
    }
</div>